package com.example.demo.service;
import com.example.demo.entity.Screening;
import com.example.demo.repository.ScreeningRepository;
import org.springframework.stereotype.Service;
import java.util.List;
@Service
public class ScreeningService { private final ScreeningRepository repo; private final MovieService movieService; private final HallService hallService; public ScreeningService(ScreeningRepository repo, MovieService movieService, HallService hallService){this.repo=repo; this.movieService=movieService; this.hallService=hallService;} public Screening create(Screening s){ movieService.get(s.getMovie().getId()).orElseThrow(()->new IllegalArgumentException("Movie not found")); hallService.get(s.getHall().getId()).orElseThrow(()->new IllegalArgumentException("Hall not found")); return repo.save(s);} public List<Screening> all(){return repo.findAll();} public java.util.Optional<Screening> get(Long id){return repo.findById(id);} public Screening update(Long id, Screening update){ return repo.findById(id).map(e->{ if(update.getMovie()!=null) e.setMovie(movieService.get(update.getMovie().getId()).orElseThrow()); if(update.getHall()!=null) e.setHall(hallService.get(update.getHall().getId()).orElseThrow()); if(update.getStartTime()!=null) e.setStartTime(update.getStartTime()); if(update.getPrice()!=null) e.setPrice(update.getPrice()); return repo.save(e); }).orElseThrow(()->new IllegalArgumentException("Screening not found")); } public void delete(Long id){repo.deleteById(id);} }
